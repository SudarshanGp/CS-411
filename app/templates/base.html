<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Crime Rates in the USA</title>
        <link href="../static/d3-geomap/css/d3.geomap.css" rel="stylesheet">
        <link href="../static/d3-slider/d3.slider.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans"/>
        <link rel="stylesheet" href="http://rawgithub.com/Caged/d3-tip/master/examples/example-styles.css">
        <script type="text/javascript" src="../static/d3/d3.js"></script>
        <script src="../static/d3-geomap/vendor/d3.geomap.dependencies.min.js"></script>
        <script src="../static/d3-geomap/js/d3.geomap.js"></script>
        <script src="../static/d3-slider/d3.slider.js"></script>
    </head>

    <style type="text/css">
    #button7 {
        background: #d39845;
        display: inline-block;
        margin: 0px 15px 0px 15px;
        border: solid 2px black;
        border-radius: 10px;
        padding: 5px;
    }
    #button6 {
        background: #bdbdbd;
        display: inline-block;
        margin: 0px 15px 0px 15px;
        border: solid 2px black;
        border-radius: 10px;
        padding: 5px;
    }
    #button5 {
        background: #a1d99b;
        display: inline-block;
        margin: 0px 15px 0px 15px;
        border: solid 2px black;
        border-radius: 10px;
        padding: 5px;
    }
    #button4 {
        background: #bcbddc;
        display: inline-block;
        margin: 0px 15px 0px 15px;
        border: solid 2px black;
        border-radius: 10px;
        padding: 5px;
    }
    #button3 {
        background: #9ecae1;
        display: inline-block;
        margin: 0px 15px 0px 15px;
        border: solid 2px black;
        border-radius: 10px;
        padding: 5px;
    }

    #button2 {
        background: #fdae6b;
        display: inline-block;
        margin: 0px 15px 0px 15px;
        border: solid 2px black;
        border-radius: 10px;
        padding: 5px;
    }

    #button1 {
        background: #fc9272;
        display: inline-block;
        margin: 0px 15px 0px 15px;
        border: solid 2px black;
        border-radius: 10px;
        padding: 5px;
    }

    #container {
        width= 800px;
        margin-top: 20px;
    }

    #centerwrapper {
        margin: auto;
        width: 930px;
    }

    body {
      font-family: Open Sans,Verdana,Arial,sans-serif;
    }

    .wrapper {
      width: 700px;
      margin-left: auto;
      margin-right: auto;
    }

    .wrapper > div {
      margin: 15px 0px 25px 0px;
    }

    #mainWrapper {
        width: 1000px;
        margin-left: auto;
        margin-right: auto;
    }

    #intro {
        margin: 0px 0px 20px 0px;
    }

    h4,
    h1 {
        margin: 0px;
    }

    #introLine h1, #introLine p {
        display:inline;
        vertical-align: baseline;

    }

    </style>
    <body>
        <div id="mainWrapper">
        <div id="intro">
        </div>
        <hr>

        <div class="wrapper">

            <div style="text-align: center;"><h2 style="margin:10px 0px 0px 0px">Year <span id="slider4text">2014</span></h2></div>
            <div id="slider4"></div>
            <div style="text-align: center;"><p style="color:#bbb">&lt;Drag or click the slider to change the year&gt;</p></div>
            </div>
            <hr>
            <div class="wrapper">
            <div style="text-align: center;"><span id="variableText" style="font-size:30px">Crime Rate per unit Population Percentage</span></div>
            <div style="text-align: center;"><p style="color:#bbb; margin:0px;">&lt;Mouse over the map to see details for each state &gt;</p></div>
        </div>

        <script type="text/javascript">
            var col = 'students';
            var sliderValue = 1966;
            var letter = 'Murder';

            var div = d3.select("#mainWrapper");
            var svg = div.append("svg")
                        .attr("id", "map13")
                        .attr("height", 500)
                        .attr("width", 960);

{#            var murder = function() {#}
{#                letter = 'Murder';#}
{#                col = 'Murder per Unit Population';#}
{#                var localV = valueIs();#}
{#                console.log("localV " + localV);#}
{#                colorMap13(localV,letter);#}
{#                d3.select('#variableText').text(letterIs())#}
{#            };#}

            colorMapStart();
            d3.select('#slider4').call(d3.slider().axis(true).min(1966).max(2012).step(1).on("slide", function(evt, value) {
            var mapLetter = letterIs();
            d3.select('#slider4text').text(value);
                colorMap13(value,mapLetter);
                sliderValue = value;
            }));


            function valueIs() {
                console.log(sliderValue);
                return sliderValue;
            }

            function letterIs() {
                console.log('letter is: ' + letter);
                return letter;
            }

            function colorMap13(sValue, z) {
                var map;
                var day_ = sValue;
                var colorScheme = z;
                if (colorScheme === 'Murder') {
                    map = d3.geomap.choropleth()
                        .geofile('../static/d3-geomap/topojson/countries/USA.json')
                        .colors(colorbrewer.Reds[9])
                        .projection(d3.geo.albersUsa)
                        .column(col)
                        .unitId('FIPS')
                        .scale(1000)
                        .legend(true);
                }

{#                var newD = [];#}
{#                var dataArray =[];#}
{#                var data = {{ data|safe }};#}

{#                for(var i=1965; i<2013; i++) {#}
{#                    var newD = [];#}
{#                    for(var prop in data) {#}
{#                        if (data[prop].Year === i.toString()) {#}
{#                            newD.push(data[prop]);#}
{#                        }#}
{#                    }#}
{#                    dataArray[i] = newD;#}
{#                };#}

                d3.select("#map13")
                    .datum(data)
                    .call(map.draw, map);
            }

            function colorMapStart() {
                var map;
                map = d3.geomap.choropleth()
                        .geofile('../static/d3-geomap/topojson/countries/USA.json')
                        .colors(colorbrewer.Reds[9])
                        .projection(d3.geo.albersUsa)
                        .column(col)
                        .unitId('FIPS')
                        .scale(1000)
                        .legend(true);
                console.log(map);

                var newD = [];
                var dataArray =[];
                var count = 0;
{#                var data = {{ data|tojson|safe }};#}
  var data = [{"students": 0, "state": "RhodeIsland", "FIPS": "US44"}, {"students": 1, "state": "Mississippi", "FIPS": "US28"}, {"students": 2, "state": "NewYork", "FIPS": "US36"}, {"students": 3, "state": "Oklahoma", "FIPS": "US40"}, {"students": 4, "state": "Delaware", "FIPS": "US10"}, {"students": 5, "state": "Minnesota", "FIPS": "US27"}, {"students": 6, "state": "Illinois", "FIPS": "US17"}, {"students": 8, "state": "Arkansas", "FIPS": "US05"}, {"students": 9, "state": "SouthCarolina", "FIPS": "US45"}, {"students": 11, "state": "Indiana", "FIPS": "US18"}, {"students": 12, "state": "Maryland", "FIPS": "US24"}, {"students": 13, "state": "Louisiana", "FIPS": "US22"}, {"students": 14, "state": "Idaho", "FIPS": "US16"}, {"students": 15, "state": "Wyoming", "FIPS": "US56"}, {"students": 16, "state": "NewHampshire", "FIPS": "US33"}, {"students": 17, "state": "Arizona", "FIPS": "US04"}, {"students": 18, "state": "Iowa", "FIPS": "US19"}, {"students": 20, "state": "Michigan", "FIPS": "US26"}, {"students": 21, "state": "Kansas", "FIPS": "US20"}, {"students": 22, "state": "Utah", "FIPS": "US49"}, {"students": 23, "state": "Virginia", "FIPS": "US51"}, {"students": 24, "state": "Oregon", "FIPS": "US41"}, {"students": 25, "state": "Connecticut", "FIPS": "US09"}, {"students": 26, "state": "Montana", "FIPS": "US30"}, {"students": 27, "state": "California", "FIPS": "US06"}, {"students": 28, "state": "Massachusetts", "FIPS": "US25"}, {"students": 29, "state": "NewMexico", "FIPS": "US35"}, {"students": 30, "state": "Wisconsin", "FIPS": "US55"}, {"students": 31, "state": "Vermont", "FIPS": "US50"}, {"students": 32, "state": "Georgia", "FIPS": "US13"}, {"students": 33, "state": "Pennsylvania", "FIPS": "US42"}, {"students": 34, "state": "NorthCarolina", "FIPS": "US37"}, {"students": 35, "state": "Florida", "FIPS": "US12"}, {"students": 36, "state": "Alaska", "FIPS": "US02"}, {"students": 37, "state": "Kentucky", "FIPS": "US21"}, {"students": 38, "state": "Hawaii", "FIPS": "US15"}, {"students": 39, "state": "SouthDakota", "FIPS": "US46"}, {"students": 40, "state": "Nebraska", "FIPS": "US31"}, {"students": 41, "state": "WestVirginia", "FIPS": "US54"}, {"students": 42, "state": "Missouri", "FIPS": "US29"}, {"students": 43, "state": "Ohio", "FIPS": "US39"}, {"students": 44, "state": "Alabama", "FIPS": "US01"}, {"students": 45, "state": "Texas", "FIPS": "US48"}, {"students": 47, "state": "Colorado", "FIPS": "US08"}, {"students": 48, "state": "DistrictOfColumbia", "FIPS": "US11"}, {"students": 51, "state": "NewJersey", "FIPS": "US34"}, {"students": 52, "state": "Washington", "FIPS": "US53"}, {"students": 53, "state": "Tennessee", "FIPS": "US47"}, {"students": 54, "state": "NorthDakota", "FIPS": "US38"}, {"students": 56, "state": "Nevada", "FIPS": "US32"}, {"students": 57, "state": "Maine", "FIPS": "US23"}];

                console.log(data);
{#                for(var i=1965; i<2013; i++) {#}
{#                    var newD = [];#}
{#                    var count = 0;#}
{#                    for(var prop in data) {#}
{#                        if (data[prop].Year === i) {#}
{#                            newD.push(data[prop]);#}
{#                        }#}
{#                    }#}
{#                    dataArray[i] = newD;#}
{#                };#}
{#                console.log(dataArray[1966]);#}
                d3.select("#map13")
                    .datum(data)
                    .call(map.draw, map);
                console.log(map);
            }

        </script>

        </div>
        <div id="mainWrapper" style="margin-top:25px">
            <p style="font-size:12px">Data source: <a href="https://www.fbi.gov/stats-services/crimestats">A series of statistical crime reports and publications, detailing specific offenses and outlining trends</a>.</p>
        </div>
    </body>
</html>
